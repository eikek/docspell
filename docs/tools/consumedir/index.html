<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Eike Kettner">
<meta name="description" content="Docspell is a Document Management System (DMS), a system that asists in organizing your piles of documents, resulting from scanners, e-mails and other sources with miminal effort.">
<meta name="keywords" content="document management system dms organizer ocr open source free scan pdf word doc archive gpl machine learning nlp auto tagging"/>
<meta name="robots" content="index,follow"/>
<meta name="image" property="og:image" content="/img/poster.png">
<meta name="title" property="og:title" content="Docspell â€“ Simple Document Organizer">
<meta name="og:image" content="/img/poster.png">
<meta name="og:title" content="Docspell â€“ Simple Document Organizer">
<meta name="og:site_name" content="Consume Directory - Docspell">
<meta name="og:url" content="">
<meta name="og:type" content="website">
<meta name="og:description" content="Simple Document Organizer">
<meta name="twitter:title" content="Docspell">
<meta name="twitter:image" content="/img/poster.png">
<meta name="twitter:description" content="Simple Document Organizer">
<meta name="twitter:card" content="summary_large_image">

<link rel="shortcut icon" href="/favicon-mc.ico" type="image/x-icon">
<link rel="icon" href="/favicon-mc.ico" type="image/x-icon">

        <title>Consume Directory â€“ Docspell Documentation</title>
        <link rel="stylesheet" href="/styles.css">
        <script type="application/javascript" src="/search_index.en.js"></script>
<script type="application/javascript" src="/elasticlunr.min.js"></script>
<script type="application/javascript" src="/js/bundle.js"></script>
<script type="application/javascript" src="/js/searchhelper.js"></script>

    </head>
    <body>
        <section class="hero is-info is-small">
            <div class="hero-head">
                <nav class="navbar">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            <span class="icon">
                <img src="/icons/logo-only-36.svg">
            </span>
            <span>
                Docspell
            </span>
        </a>
    </div>
    <div class="navbar-start">
        <a target="_blank"
           href="https://github.com/eikek/docspell"
           class="navbar-item">
            <span class="icon">
                <img src="/icons/github-40.svg">
            </span>
            <span>
                Github
            </span>
        </a>
    </div>
</nav>

            </div>
            <div class="hero-body">
                <div class="columns is-vcentered">
                    <div class="column is-8">
                        <h1 class="title">
                            Consume Directory
                        </h1>
                        <h2 class="subtitle">
                            Docspell Documentation
                        </h2>
                    </div>
                    <div class="column">
                        <id id="search"></id>
                    </div>
                </div>
            </div>
        </section>
        <nav class="breadcrumb has-succeeds-separator" aria-label="breadcrumbs"
             style="position:sticky; top: 0; z-index:10;">
            <ul>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;"></a>
                </li>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;">Overview</a>
                </li>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;tools&#x2F;">Tools</a>
                </li>
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;tools&#x2F;consumedir&#x2F;">Consume Directory</a>
                </li>
            </ul>
        </nav>

        <section class="section pt-2">
            <div class="columns is-desktop">
                <div class="column is-3">
                    <div class="menu"
                         style="position:sticky; top:2rem; z-index:10;">
                        <ul class="menu-list">
                            
                            

                            <p class="menu-label">
                                Tools
                            </p>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/tools/ds/"
                                   >
                                    Upload Cli
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/tools/android/"
                                   >
                                    Android Client
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/tools/consumedir/"
                                   class="is-active">
                                    Consume Directory
                                </a>
                                
                                <ul class="menu-list">
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;tools&#x2F;consumedir&#x2F;#introduction">
                                            Introduction
                                        </a>
                                        <ul>
                                            
                                            <li>
                                                <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;tools&#x2F;consumedir&#x2F;#integration-endpoint">
                                                    Integration Endpoint
                                                </a>
                                            </li>
                                            
                                            <li>
                                                <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;tools&#x2F;consumedir&#x2F;#duplicates">
                                                    Duplicates
                                                </a>
                                            </li>
                                            
                                            <li>
                                                <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;tools&#x2F;consumedir&#x2F;#network-filesystems-samba-cifs-nfs">
                                                    Network Filesystems (samba cifs, nfs)
                                                </a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;tools&#x2F;consumedir&#x2F;#systemd">
                                            Systemd
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;tools&#x2F;consumedir&#x2F;#docker">
                                            Docker
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                </ul>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/tools/consumedir-cleaner/"
                                   >
                                    Directory Cleaner
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/tools/paperless-import/"
                                   >
                                    Paperless Import
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/tools/browserext/"
                                   >
                                    Browser Extension (Firefox)
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/tools/smtpgateway/"
                                   >
                                    Smtp Gateway With Exim
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/tools/convert-all-pdf/"
                                   >
                                    Convert All Pdfs
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/tools/export-files/"
                                   >
                                    Export Files
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/tools/reset-password/"
                                   >
                                    Reset Password
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/tools/regenerate-previews/"
                                   >
                                    Regenerate Preview Images
                                </a>
                                
                            </li>
                            
                        </ul>
                    </div>
                </div>

                <div class="column is-9">
                    <div class="container">
                        <div class="content doc">
                            <h1 id="introduction">Introduction<a class="zola-anchor" href="#introduction" aria-label="Anchor link for: introduction">ðŸ”—</a></h1>
<p>The <code>consumerdir.sh</code> is a bash script that works in two modes:</p>
<ul>
<li>Go through all files in given directories (recursively, if <code>-r</code> is
specified) and sent each to docspell.</li>
<li>Watch one or more directories for new files and upload them to
docspell.</li>
</ul>
<p>It can watch or go through one or more directories. Files can be
uploaded to multiple urls.</p>
<p>Run the script with the <code>-h</code> or <code>--help</code> option, to see a short help
text. The help text will also show the values for any given option.</p>
<p>The script requires <code>curl</code> for uploading. It requires the
<code>inotifywait</code> command if directories should be watched for new
files.</p>
<p>Example for watching two directories:</p>
<pre style="background-color:#282828;">
<code><span style="color:#fdf4c1;">./tools/consumedir.sh --path ~/Downloads --path ~/pdfs -m -dv http://localhost:7880/api/v1/open/upload/item/5DxhjkvWf9S-CkWqF3Kr892-WgoCspFWDo7-XBykwCyAUxQ
</span></code></pre>
<p>The script by default watches the given directories. If the <code>-o</code> or
<code>--once</code> option is used, it will instead go through these directories
and upload all files in there.</p>
<p>Example for uploading all immediatly (the same as above only with <code>-o</code>
added):</p>
<pre style="background-color:#282828;">
<code><span style="color:#fdf4c1;">$ consumedir.sh -o --path ~/Downloads --path ~/pdfs/ -m -dv http://localhost:7880/api/v1/open/upload/item/5DxhjkvWf9S-CkWqF3Kr892-WgoCspFWDo7-XBykwCyAUxQ
</span></code></pre>
<p>The URL can be any docspell url that accepts uploads without
authentication. This is usually a <a href="https://docspell.org/docs/webapp/uploading/#anonymous-upload">source
url</a>. It is also possible
to use the script with the <a href="https://docspell.org/docs/api/upload/#integration-endpoint">integration
endpoint</a>.</p>
<p>The script can be run multiple times and on on multiple machines, the
files are transferred via HTTP to the docspell server. For example, it
is convenient to set it up on your workstation, so that you can drop
files into some local folder to be immediatly transferred to docspell
(e.g. when downloading something from the browser).</p>
<h2 id="integration-endpoint">Integration Endpoint<a class="zola-anchor" href="#integration-endpoint" aria-label="Anchor link for: integration-endpoint">ðŸ”—</a></h2>
<p>When given the <code>-i</code> or <code>--integration</code> option, the script changes its
behaviour slightly to work with the <a href="https://docspell.org/docs/api/upload/#integration-endpoint">integration
endpoint</a>.</p>
<p>First, if <code>-i</code> is given, it implies <code>-r</code> â€“ so the directories are
watched or traversed recursively. The script then assumes that there
is a subfolder with the collective name. Files must not be placed
directly into a folder given by <code>-p</code>, but below a sub-directory that
matches a collective name. In order to know for which collective the
file is, the script uses the first subfolder.</p>
<p>If the endpoint is protected, the credentials can be specified as
arguments <code>--iuser</code> and <code>--iheader</code>, respectively. The format is for
both <code>&lt;name&gt;:&lt;value&gt;</code>, so the username cannot contain a colon
character (but the password can).</p>
<p>Example:</p>
<pre style="background-color:#282828;">
<code><span style="color:#fdf4c1;">$ consumedir.sh -i -iheader </span><span style="color:#b8bb26;">&#39;Docspell-Integration:test123&#39;</span><span style="color:#fdf4c1;"> -m -p ~/Downloads/ http://localhost:7880/api/v1/open/integration/item
</span></code></pre>
<p>The url is the integration endpoint url without the collective, as
this is amended by the script.</p>
<p>This watches the folder <code>~/Downloads</code>. If a file is placed in this
folder directly, say <code>~/Downloads/test.pdf</code> the upload will fail,
because the collective cannot be determined. Create a subfolder below
<code>~/Downloads</code> with the name of a collective, for example
<code>~/Downloads/family</code> and place files somewhere below this <code>family</code>
subfolder, like <code>~/Downloads/family/test.pdf</code>.</p>
<h2 id="duplicates">Duplicates<a class="zola-anchor" href="#duplicates" aria-label="Anchor link for: duplicates">ðŸ”—</a></h2>
<p>With the <code>-m</code> option, the script will not upload files that already
exist at docspell. For this the <code>sha256sum</code> command is required.</p>
<p>So you can move and rename files in those folders without worring
about duplicates. This allows to keep your files organized using the
file-system and have them mirrored into docspell as well.</p>
<h2 id="network-filesystems-samba-cifs-nfs">Network Filesystems (samba cifs, nfs)<a class="zola-anchor" href="#network-filesystems-samba-cifs-nfs" aria-label="Anchor link for: network-filesystems-samba-cifs-nfs">ðŸ”—</a></h2>
<p>Watching a directory for changes relies on <code>inotify</code> subsystem on
linux. This doesn't work on network filesystems like nfs or cifs. Here
are some ideas to get around this limitation:</p>
<ol>
<li>The <code>consumedir.sh</code> is just a shell script and doesn't need to run
on the same machine as docspell. (Note that the default docker
setup is mainly for demoing and quickstart, it's not required to
run all of them on one machine). So the best option is to put the
consumedir on the machine that contains the local filesystem. All
files are send via HTTP to the docspell server anyways, so there is
no need to first transfer them via a network filesystem or rsync.</li>
<li>If option 1 is not possible for some reason, and you need to check
a network filesystem, the only option left (that I know) is to
periodically poll this directory. This is also possible with
consumedir, using the <code>-o</code> or <code>--once</code> option (see above). You'd
need to setup the systemd unit file a bit differently and add a
timer to it (or you can use cron or something more fancyâ€¦).</li>
<li>Copy the files to the machine that runs consumedir, via rsync for
example. Note that this has no advantage over otpion 1, as you now
need to setup rsync on the other machine to run either periodically
or when some file arrives. Then you can as well run the consumedir
script. But it might be more convenient, if rsync is already
running.</li>
</ol>
<h1 id="systemd">Systemd<a class="zola-anchor" href="#systemd" aria-label="Anchor link for: systemd">ðŸ”—</a></h1>
<p>The script can be used with systemd to run as a service. This is an
example unit file:</p>
<pre style="background-color:#282828;">
<code><span style="color:#fdf4c1aa;">[Unit]
After=networking.target
Description=Docspell Consumedir

[Service]
Environment=&quot;PATH=/set/a/path&quot;

ExecStart=/bin/su -s /bin/bash someuser -c &quot;consumedir.sh --path &#39;/a/path/&#39; -m &#39;http://localhost:7880/api/v1/open/upload/item/5DxhjkvWf9S-CkWqF3Kr892-WgoCspFWDo7-XBykwCyAUxQ&#39;&quot;
</span></code></pre>
<p>This unit file is just an example, it needs some fiddling. It assumes
an existing user <code>someuser</code> that is used to run this service. The url
<code>http://localhost:7880/api/v1/open/upload/...</code> is an anonymous upload
url as described <a href="https://docspell.org/docs/webapp/uploading/#anonymous-upload">here</a>.</p>
<h1 id="docker">Docker<a class="zola-anchor" href="#docker" aria-label="Anchor link for: docker">ðŸ”—</a></h1>
<p>The provided docker-compose setup runs this script to watch a single
directory, <code>./docs</code> in current directory, for new files. If a new file
is detected, it is pushed to docspell.</p>
<p>This utilizes the <a href="https://docspell.org/docs/api/upload/#integration-endpoint">integration
endpoint</a>, which is
enabled in the config file, to allow uploading documents for all
collectives. A subfolder must be created for each registered
collective. The docker containers are configured to use http-header
protection for the integration endpoint. This requires you to provide
a secret, that is shared between the rest-server and the
<code>consumedir.sh</code> script. This can be done by defining an environment
variable which gets picked up by the containers defined in
<code>docker-compose.yml</code>:</p>
<pre style="background-color:#282828;">
<code><span style="color:#fa5c4b;">export </span><span style="color:#fdf4c1;">DOCSPELL_HEADER_VALUE</span><span style="color:#fe8019;">=</span><span style="color:#b8bb26;">&quot;my-secret&quot;
</span><span style="color:#fdf4c1;">docker-compose up
</span></code></pre>
<p>Now you can create a folder <code>./docs/&lt;collective-name&gt;</code> and place all
files in there that you want to import. Once dropped in this folder
the <code>consumedir</code> container will push it to docspell.</p>

                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="footer">
    <div class="container">
        <div class="content has-text-centered">
            <span>
                Docspell, 0.21.0
            </span>
            <span class="ml-1 mr-1">â€¢</span>
            <a href="https://spdx.org/licenses/GPL-3.0-or-later.html" target="_blank">GPLv3+</a>
            <span class="ml-1 mr-1">â€¢</span>
            <a href="https://github.com/eikek/docspell" target="_blank">
                Source Code
            </a>
            <span class="ml-1 mr-1">â€¢</span>
            <span>
                <a href="https://gitter.im/eikek/docspell">Chat on Gitter</a>
            </span>
        </div>
    </div>
    
</footer>

        <script>
 var initSearch = function() {
     var elmSearch = Elm.Search.init({
         node: document.getElementById("search"),
         flags: {}
     });
     initElmSearch(elmSearch);
 }
 if (document.readyState === "complete" ||
     (document.readyState !== "loading" && !document.documentElement.doScroll)
 ) {
     initSearch();
 } else {
     document.addEventListener("DOMContentLoaded", initSearch);
 }
</script>

        <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
<script>
 (function(f, a, t, h, o, m){
     a[h]=a[h]||function(){
         (a[h].q=a[h].q||[]).push(arguments)
     };
     o=f.createElement('script'),
     m=f.getElementsByTagName('script')[0];
     o.async=1; o.src=t; o.id='fathom-script';
     m.parentNode.insertBefore(o,m)
 })(document, window, '//webstats.daheim.site/tracker.js', 'fathom');
 fathom('set', 'siteId', 'OGJDF');
 fathom('trackPageview');
</script>
<!-- / Fathom -->

    </body>
</html>
