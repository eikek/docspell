<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Eike Kettner">
<meta name="description" content="Docspell is a Document Management System (DMS), a system that asists in organizing your piles of documents, resulting from scanners, e-mails and other sources with miminal effort.">
<meta name="keywords" content="document management system dms organizer ocr open source free scan pdf word doc archive gpl machine learning nlp auto tagging"/>
<meta name="robots" content="index,follow"/>
<meta name="image" property="og:image" content="/img/poster.png">
<meta name="title" property="og:title" content="Docspell â€“ Simple Document Organizer">
<meta name="og:image" content="/img/poster.png">
<meta name="og:title" content="Docspell â€“ Simple Document Organizer">
<meta name="og:site_name" content="Tips &amp; Setup - Docspell">
<meta name="og:url" content="">
<meta name="og:type" content="website">
<meta name="og:description" content="Simple Document Organizer">
<meta name="twitter:title" content="Docspell">
<meta name="twitter:image" content="/img/poster.png">
<meta name="twitter:description" content="Simple Document Organizer">
<meta name="twitter:card" content="summary_large_image">

<link rel="shortcut icon" href="/favicon-mc.ico" type="image/x-icon">
<link rel="icon" href="/favicon-mc.ico" type="image/x-icon">

        <title>Tips &amp; Setup â€“ Docspell Documentation</title>
        <link rel="stylesheet" href="/styles.css">
    </head>
    <body>
        <section class="hero is-info is-small">
            <div class="hero-head">
                <nav class="navbar">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            <span class="icon">
                <img src="/icons/logo-only-36.svg">
            </span>
            <span>
                Docspell
            </span>
        </a>
    </div>
    <div class="navbar-start">
        <a target="_blank"
           href="https://github.com/eikek/docspell"
           class="navbar-item">
            <span class="icon">
                <img src="/icons/github-40.svg">
            </span>
            <span>
                Github
            </span>
        </a>
    </div>
</nav>

            </div>
            <div class="hero-body">
                <div class="columns is-vcentered">
                    <div class="column is-8">
                        <h1 class="title">
                            Tips &amp; Setup
                        </h1>
                        <h2 class="subtitle">
                            Docspell Documentation
                        </h2>
                    </div>
                    <div class="column">
                        <id id="search"></id>
                    </div>
                </div>
            </div>
        </section>
        <nav class="breadcrumb has-succeeds-separator" aria-label="breadcrumbs"
             style="position:sticky; top: 0; z-index:10;">
            <ul>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;"></a>
                </li>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;">Overview</a>
                </li>
                
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;">Development</a>
                </li>
                
                <li>
                    <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;development&#x2F;">Tips &amp; Setup</a>
                </li>
            </ul>
        </nav>

        <section class="section pt-2">
            <div class="columns is-desktop">
                <div class="column is-3">
                    <div class="menu"
                         style="position:sticky; top:2rem; z-index:10;">
                        <ul class="menu-list">
                            
                            

                            <p class="menu-label">
                                Development
                            </p>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/building/"
                                   >
                                    Building Docspell
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/translation/"
                                   >
                                    Translating Web-Ui
                                </a>
                                
                            </li>
                            
                            
                            <li>
                                <a href="https://docspell.org/docs/dev/development/"
                                   class="is-active">
                                    Tips &amp; Setup
                                </a>
                                
                                <ul class="menu-list">
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;development&#x2F;#starting-servers-with-restart">
                                            Starting Servers with reStart
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;development&#x2F;#custom-config-file">
                                            Custom config file
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;development&#x2F;#developing-frontend">
                                            Developing Frontend
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;development&#x2F;#developing-backend">
                                            Developing Backend
                                        </a>
                                        <ul>
                                            
                                            <li>
                                                <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;development&#x2F;#openapi">
                                                    OpenAPI
                                                </a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;development&#x2F;#nix-expressions">
                                            Nix Expressions
                                        </a>
                                        <ul>
                                            
                                            <li>
                                                <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;development&#x2F;#testing-nixos-modules">
                                                    Testing NixOS Modules
                                                </a>
                                            </li>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;development&#x2F;#release">
                                            Release
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                    <li>
                                        <a href="https:&#x2F;&#x2F;docspell.org&#x2F;docs&#x2F;dev&#x2F;development&#x2F;#background-info">
                                            Background Info
                                        </a>
                                        <ul>
                                            
                                        </ul>
                                    </li>
                                    
                                </ul>
                                
                            </li>
                            
                        </ul>
                    </div>
                </div>

                <div class="column is-9">
                    <div class="container">
                        <div class="content doc">
                            <h1 id="starting-servers-with-restart">Starting Servers with <code>reStart</code><a class="zola-anchor" href="#starting-servers-with-restart" aria-label="Anchor link for: starting-servers-with-restart">ðŸ”—</a></h1>
<p>When developing, it's very convenient to use the <a href="https://github.com/spray/sbt-revolver">revolver sbt
plugin</a>. Start the sbt console
and then run:</p>
<pre style="background-color:#282828;color:#fdf4c1aa;"><code><span>sbt:docspell-root&gt; restserver/reStart
</span></code></pre>
<p>This starts a REST server. Once this started up, type:</p>
<pre style="background-color:#282828;color:#fdf4c1aa;"><code><span>sbt:docspell-root&gt; joex/reStart
</span></code></pre>
<p>if also a joex component is required. Prefixing the commads with <code>~</code>,
results in recompile+restart once a source file is modified.</p>
<p>It is possible to start both in the root project:</p>
<pre style="background-color:#282828;color:#fdf4c1aa;"><code><span>sbt:docspell-root&gt; reStart
</span></code></pre>
<h1 id="custom-config-file">Custom config file<a class="zola-anchor" href="#custom-config-file" aria-label="Anchor link for: custom-config-file">ðŸ”—</a></h1>
<p>The sbt build is setup such that a file <code>dev.conf</code> in the directory
<code>local</code> (at root of the source tree) is picked up as config file, if
it exists. So you can create a custom config file for development. For
example, a custom database for development may be setup this way:</p>
<pre data-lang="bash" style="background-color:#282828;color:#fdf4c1aa;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-style:italic;color:#928374;">#jdbcurl = &quot;jdbc:h2:///home/dev/workspace/projects/docspell/local/docspell-demo.db;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;AUTO_SERVER=TRUE&quot;
</span><span style="color:#fdf4c1;">jdbcurl = </span><span style="color:#b8bb26;">&quot;jdbc:postgresql://localhost:5432/docspelldev&quot;
</span><span style="font-style:italic;color:#928374;">#jdbcurl = &quot;jdbc:mariadb://localhost:3306/docspelldev&quot;
</span><span>
</span><span style="color:#fdf4c1;">docspell.server {
</span><span style="color:#fdf4c1;">  backend {
</span><span style="color:#fdf4c1;">    jdbc {
</span><span style="color:#fdf4c1;">      url = ${jdbcurl}
</span><span style="color:#fdf4c1;">      user = </span><span style="color:#b8bb26;">&quot;dev&quot;
</span><span style="color:#fdf4c1;">      password = </span><span style="color:#b8bb26;">&quot;dev&quot;
</span><span style="color:#fdf4c1;">    }
</span><span style="color:#fdf4c1;">  }
</span><span style="color:#fdf4c1;">}
</span><span>
</span><span style="color:#fdf4c1;">docspell.joex {
</span><span style="color:#fdf4c1;">  jdbc {
</span><span style="color:#fdf4c1;">    url = ${jdbcurl}
</span><span style="color:#fdf4c1;">    user = </span><span style="color:#b8bb26;">&quot;dev&quot;
</span><span style="color:#fdf4c1;">    password = </span><span style="color:#b8bb26;">&quot;dev&quot;
</span><span style="color:#fdf4c1;">  }
</span><span style="color:#fdf4c1;">  scheduler {
</span><span style="color:#fdf4c1;">    pool-size = 1
</span><span style="color:#fdf4c1;">  }
</span><span style="color:#fdf4c1;">}
</span></code></pre>
<h1 id="developing-frontend">Developing Frontend<a class="zola-anchor" href="#developing-frontend" aria-label="Anchor link for: developing-frontend">ðŸ”—</a></h1>
<p>The frontend is a SPA written in <a href="https://elm-lang.org">Elm</a>. The UI
framework in use is <a href="https://tailwindcss.com">tailwind</a>.</p>
<p>The frontend code is in the sub-project <code>webapp</code>. Running sbt's
<code>compile</code> task, compiles elm sources and creates the final CSS file.
Whenever the <code>restserver</code> module is build by sbt, the <code>webapp</code>
sub-project is built as well and the final files to deliver are
updated. So, when in sbt shell, &quot;watch-compile&quot; the project
<code>restserver</code>, (via <code>~ restserver/compile</code>), re-compiles elm-code on
change. However, it also re-creates the final css, which is a rather
long task.</p>
<p>To speed things up when only developing the frontend, a bash script is
provided in <code>project/dev-ui-build.sh</code>. Start the <code>restserver</code> once,
using <code>restserver/reStart</code> task as described above. Then run this
script in the source root. It will watch elm files and the css file
and re-compiles only on change writing the resulting files in the
correct locations so they get picked up by the restserver.</p>
<p>Now you can edit elm files and the <code>index.css</code> and then only refresh
the page. Elm compilation is <em>very</em> fast, it's difficult to reach the
refresh button before it is done compiling :). When editing the CSS,
it takes a little longer, but this is hardly necessary, thanks to
tailwind.</p>
<p>There is still a problem: the browser caches the js and css files by
default, so a page refresh is not enough, you need to clear the cache,
too. To avoid this annoyance, set a env variable <code>DOCSPELL_ENV</code> to the
value <code>dev</code>. Docspell then adds a response header, preventing the
browser to cache these files. This must be done, obviously, before
starting the restserver:</p>
<pre data-lang="bash" style="background-color:#282828;color:#fdf4c1aa;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#fdf4c1;">$ export DOCSPELL_ENV=dev
</span><span style="color:#fdf4c1;">$ sbt </span><span style="color:#b8bb26;">&quot;restserver/reStart&quot;
</span></code></pre>
<h1 id="developing-backend">Developing Backend<a class="zola-anchor" href="#developing-backend" aria-label="Anchor link for: developing-backend">ðŸ”—</a></h1>
<h2 id="openapi">OpenAPI<a class="zola-anchor" href="#openapi" aria-label="Anchor link for: openapi">ðŸ”—</a></h2>
<p>The http API is specified in the corresponding <code>-openapi.yml</code> file.
The <code>component</code> section is being used to generate code for the client
and the server, so that both are always in sync. However, the route
definitions are not checked against the server implementation.</p>
<p>Changes to the openapi files can be checked by running a sbt task:</p>
<pre data-lang="scala" style="background-color:#282828;color:#fdf4c1aa;" class="language-scala "><code class="language-scala" data-lang="scala"><span>restapi/openapiLint </span><span style="font-style:italic;color:#928374;">//and/or
</span><span>joexapi/openapiLint
</span></code></pre>
<p>These tasks must not show any errors (it is checked by the CI). The
warnings should also be fixed.</p>
<h1 id="nix-expressions">Nix Expressions<a class="zola-anchor" href="#nix-expressions" aria-label="Anchor link for: nix-expressions">ðŸ”—</a></h1>
<p>The directory <code>/nix</code> contains nix expressions to install docspell via
the nix package manager and to integrate it into NixOS.</p>
<h2 id="testing-nixos-modules">Testing NixOS Modules<a class="zola-anchor" href="#testing-nixos-modules" aria-label="Anchor link for: testing-nixos-modules">ðŸ”—</a></h2>
<p>The modules can be build by building the <code>configuration-test.nix</code> file
together with some nixpkgs version. For example:</p>
<pre data-lang="bash" style="background-color:#282828;color:#fdf4c1aa;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#fdf4c1;">nixos-rebuild build-vm -I nixos-config=./configuration-test.nix \
</span><span style="color:#fdf4c1;">  -I nixpkgs=https://github.com/NixOS/nixpkgs-channels/archive/nixos-19.09.tar.gz
</span></code></pre>
<p>This will build all modules imported in <code>configuration-test.nix</code> and
create a virtual machine containing the system. After that completes,
the system configuration can be found behind the <code>./result/system</code>
symlink. So it is possible to look at the generated systemd config for
example:</p>
<pre data-lang="bash" style="background-color:#282828;color:#fdf4c1aa;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#fdf4c1;">cat result/system/etc/systemd/system/docspell-joex.service
</span></code></pre>
<p>And with some more commands (there probably is an easier wayâ€¦) the
config file can be checked:</p>
<pre data-lang="bash" style="background-color:#282828;color:#fdf4c1aa;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#fdf4c1;">cat result/system/etc/systemd/system/docspell-joex.service </span><span style="color:#fe8019;">| </span><span style="color:#fdf4c1;">grep ExecStart </span><span style="color:#fe8019;">| </span><span style="color:#fdf4c1;">cut -d</span><span style="color:#b8bb26;">&#39;=&#39;</span><span style="color:#fdf4c1;"> -f2 </span><span style="color:#fe8019;">| </span><span style="color:#fdf4c1;">xargs cat </span><span style="color:#fe8019;">| </span><span style="color:#fdf4c1;">tail -n1 </span><span style="color:#fe8019;">| </span><span style="color:#fdf4c1;">awk </span><span style="color:#b8bb26;">&#39;{print $NF}&#39;</span><span style="color:#fe8019;">| </span><span style="color:#fdf4c1;">sed </span><span style="color:#b8bb26;">&#39;s/.$//&#39; </span><span style="color:#fe8019;">| </span><span style="color:#fdf4c1;">xargs cat </span><span style="color:#fe8019;">| </span><span style="color:#fdf4c1;">jq
</span></code></pre>
<p>To see the module in action, the vm can be started (the first line
sets more memory for the vm):</p>
<pre data-lang="bash" style="background-color:#282828;color:#fdf4c1aa;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#fa5c4b;">export </span><span style="color:#fdf4c1;">QEMU_OPTS</span><span style="color:#fe8019;">=</span><span style="color:#b8bb26;">&quot;-m 2048&quot;
</span><span style="color:#fa5c4b;">export </span><span style="color:#fdf4c1;">QEMU_NET_OPTS </span><span style="color:#b8bb26;">&quot;hostfwd=tcp::7880-:7880&quot;
</span><span style="color:#fdf4c1;">./result/bin/run-docspelltest-vm
</span></code></pre>
<h1 id="release">Release<a class="zola-anchor" href="#release" aria-label="Anchor link for: release">ðŸ”—</a></h1>
<p>The CI and making a release is done via <a href="https://docs.github.com/en/actions">github
actions</a>. The workflow is roughly
like this:</p>
<ul>
<li>each PR is only merged if the <code>sbt ci</code> task returns successfully.
This is ensured by the <code>ci.yml</code> workflow that triggers on each pull
request</li>
<li>each commit to the <code>master</code> branch is also going through <code>sbt ci</code>
and then a prerelease is created. The tag <code>nightly</code> is used to point
to the latest commit in <code>master</code>. Note, that this is <a href="https://git-scm.com/docs/git-tag#_on_re_tagging">discouraged by
git</a>, but github
doesn't allow to create a release without a tag. So this tag moves
(and is not really a tag thenâ€¦). After the prerelease is created,
the docker images are built and pushed to docker hub into the
<a href="https://hub.docker.com/u/docspell">docspell</a> organization. The
docker images are also tagged with <code>nightly</code> at docker hub. This is
all done via the <code>realease-nightly.yml</code> workflow.</li>
<li>A stable release is started by pushing a tag with pattern <code>v*</code> to
github. This triggers the <code>release.yml</code> workflow which builds the
packages and creates a release in <em>draft mode</em>. The <code>sbt ci</code> task
<em>is not</em> run, because it is meant to only release commits already in
the <code>master</code> branch. After this completes, the release notes need to
be added manually and then the release must be published at github.
This then triggers the <code>docker-images.yml</code> workflow, which builds
the corresponding docker images and pushes them to docker hub. The
docker images are tagged with the exact version and the <code>latest</code> tag
is moved to the new images. Another manual step is to set the branch
<code>current-docs</code> to its new state and push it to github. This will
trigger a build+publish of the website.</li>
<li>Publishing the website happens automatically on each push to the
branch <code>current-docs</code>. Changes to the current website must be based
on this branch.</li>
</ul>
<p>Some notes: I wanted a 2/3 step process when doing a stable release,
to be able to add release notes manually (I don't want this to be
automated right now) and to do some testing with the packages before
publishing the release. However, for the nightly releases, this
doesn't matter - everything must be automated here obviously. I also
wanted the docker images to be built from the exact same artifacts
that have been released at github (in contrast to being built again).</p>
<h1 id="background-info">Background Info<a class="zola-anchor" href="#background-info" aria-label="Anchor link for: background-info">ðŸ”—</a></h1>
<p>There is a list of <a href="https://docspell.org/docs/dev/adr/">ADRs</a> containing
internal/background info for various topics.</p>

                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="footer">
    <div class="container">
        <div class="content has-text-centered">
            <span>
                Docspell 0.29.0
            </span>
            <span class="ml-1 mr-1">â€¢</span>
            <a href="https://spdx.org/licenses/AGPL-3.0-or-later.html" target="_blank">AGPLv3+</a>
            <span class="ml-1 mr-1">â€¢</span>
            <a href="https://github.com/eikek/docspell" target="_blank">
                Source Code
            </a>
            <span class="ml-1 mr-1">â€¢</span>
            <span>
                Chat on <a href="https://gitter.im/eikek/docspell">Gitter</a>/<a href="https://app.element.io/#/room/#eikek_docspell:gitter.im">Matrix</a>
            </span>
        </div>
    </div>
    
</footer>

        <script type="text/javascript" src="https://docspell.org/elasticlunr.min.js"></script>
<script type="text/javascript" src="https://docspell.org/search_index.en.js"></script>
<script type="text/javascript" src="https://docspell.org/js/searchhelper.js"></script>
<script type="text/javascript" src="https://docspell.org/js/bundle.js"></script>

        <script>
 var initSearch = function() {
     var elmSearch = Elm.Search.init({
         node: document.getElementById("search"),
         flags: {}
     });
     initElmSearch(elmSearch);
 }
 if (document.readyState === "complete" ||
     (document.readyState !== "loading" && !document.documentElement.doScroll)
 ) {
     initSearch();
 } else {
     document.addEventListener("DOMContentLoaded", initSearch);
 }
</script>

        <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
<script>
 (function(f, a, t, h, o, m){
     a[h]=a[h]||function(){
         (a[h].q=a[h].q||[]).push(arguments)
     };
     o=f.createElement('script'),
     m=f.getElementsByTagName('script')[0];
     o.async=1; o.src=t; o.id='fathom-script';
     m.parentNode.insertBefore(o,m)
 })(document, window, '//webstats.daheim.site/tracker.js', 'fathom');
 fathom('set', 'siteId', 'OGJDF');
 fathom('trackPageview');
</script>
<!-- / Fathom -->

    </body>
</html>
